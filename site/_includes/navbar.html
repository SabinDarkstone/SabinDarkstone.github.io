<nav class="navbar sticky-top navbar-expand-md" id="navParent">
    <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="#">
            <img src="/assets/imgs/favicon.png" class="d-inline-block align-text-top" height="24" width="24"/>
            About Me
        </a>

        <div class="collapse navbar-collapse" id="navbarToggler">
            <ul class="navbar-nav nav nav-pills me-auto mt-2 mt-md-0">
                {% for nav in site.data.navbar %}
                {% assign p = page.url | downcase %}
                    {% if page.url == "/" and nav.name == "index" %}
                        {% assign active = true %}
                    {% elsif page.url contains nav.name %}
                        {% assign active = true %}
                    {% else %}
                        {% assign active = false %}
                    {% endif %}
                    <li class="nav-item">
                        <a class="nav-link {% if active %}active{% endif %}" href="{{ nav.url }}">
                            {% if nav.icon %}
                                <i class="bi {{ nav.icon }}"></i>
                            {% endif %}
                            {{ nav.label }}
                        </a>
                    </li>
                {% endfor %}
            </ul>

            <form class="form-inline my-2 my-md-0">
                <button id="themeToggle" class="btn btn-sm btn-primary" type="button">
                    <i class="bi bi-moon-fill me-1"></i>
                    <span>Dark</span>
                </button>
            </form>
        </div>
    </div>
</nav>

<script>
    (function () {
        const btn = document.getElementById("themeToggle");
        const nav = document.getElementById("navParent");
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        const stored = localStorage.getItem("theme");
        const theme = stored || (prefersDark ? "dark" : "light");

        function render(t) {
            document.documentElement.setAttribute("data-bs-theme", t);
            btn.setAttribute("aria-pressed", t === "dark");
            btn.innerHTML = (t === "dark")
                ? "<i class='bi bi-brightness-high-fill me-1' aria-hidden='true'></i><span>Light</span>"
                : "<i class='bi bi-moon-fill me-1' aria-hidden='true'></i><span>Dark</span>";
            if (t === "dark") {
                nav.classList.remove("bg-light");
                nav.classList.remove("navbar-light");
                nav.classList.add("bg-dark");
                nav.classList.add("navbar-dark");
                btn.style.color = "white";
            } else {
                nav.classList.remove("bg-dark");
                nav.classList.remove("navbar-dark");
                nav.classList.add("bg-light");
                nav.classList.add("navbar-light");
                btn.style.color = "black";
            }
        }

        render(theme);

        btn.addEventListener("click", () => {
            const next = (document.documentElement.getAttribute("data-bs-theme") === "dark") ? "light" : "dark";
            localStorage.setItem("theme", next);
            render(next);
        });
    })();
</script>